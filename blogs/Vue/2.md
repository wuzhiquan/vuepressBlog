---
title: Vue3å­¦ä¹ 
date: 2021-07-20
tags:
 - Vue3
categories:
 -  Vue
sticky:
 -  2
---

# å…ˆæ¨èä¸¤ä¸ªvscodeæ’ä»¶

## Volar

é¦–å…ˆæ¨è`Volar`ï¼Œä½¿ç”¨`vscode`å¼€å‘`Vue`é¡¹ç›®çš„å°ä¼™ä¼´è‚¯å®šéƒ½è®¤è¯†`Vetur`è¿™ä¸ªç¥çº§æ’ä»¶ï¼Œæœ‰äº†å®ƒå¯ä»¥è®©æˆ‘ä»¬å¾—å¼€å‘å¦‚é±¼å¾—æ°´ã€‚ é‚£ä¹ˆ`Volar`å¯ä»¥ç†è§£ä¸º`Vue3`ç‰ˆæœ¬çš„`Vetur`ï¼Œä»£ç é«˜äº®ï¼Œè¯­æ³•æç¤ºï¼ŒåŸºæœ¬ä¸Š`Vetur`æœ‰çš„å®ƒéƒ½æœ‰ã€‚

### ç‰¹è‰²åŠŸèƒ½

å½“ç„¶ä½œä¸ºæ–°çš„æ’ä»¶å‡ºå±±ï¼Œè‚¯å®šæœ‰å®ƒç‹¬æœ‰çš„åŠŸèƒ½ã€‚

#### å¤šä¸ªæ ¹èŠ‚ç‚¹ç¼–è¾‘å™¨ä¸ä¼šæŠ¥é”™

`Vue3`æ˜¯å…è®¸æˆ‘ä»¬æœ‰å¤šä¸ªæ ¹èŠ‚ç‚¹çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœä½¿ç”¨Veturå°±ä¼šæŠ¥é”™ï¼Œä¸ä¼šå½±å“è¿è¡Œï¼Œä½†æ˜¯çœ‹èµ·æ¥å°±å¾ˆçƒ¦ã€‚ æ‰€ä»¥å½“æˆ‘ä»¬è½¬å‘`Volar`é‚£ä¹ˆå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜äº†ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/841516d7cc9442fdb6b864480a537dcc~tplv-k3u1fbpfcp-watermark.awebp)

#### ç¼–è¾‘å™¨åˆ†éš”

å³ä¾¿`Vue`çš„ç»„ä»¶åŒ–å¼€å‘ï¼Œå¯ä»¥å°†å•æ–‡ä»¶çš„ä»£ç é•¿åº¦å¤§å¹…ç¼©çŸ­ï¼Œä½†è¿˜æ˜¯åŠ¨è¾„å‡ ç™¾è¡Œç”šæ˜¯ä¸Šåƒè¡Œã€‚é‚£ä¹ˆæˆ‘ä»¬åˆ‡æ¢`template`ï¼Œ`script`å’Œ`style`çš„æ—¶å€™å°±è¦é¢‘ç¹ä¸Šä¸‹ç¿»ï¼Œè™½ç„¶æœ‰çš„æ’ä»¶å¯ä»¥ç›´æ¥å®šä½åˆ°`css`ï¼Œä½†æ˜¯ä½ å›ä¸å»å•Šï¼æ‰€ä»¥è¿™ä¸ªåŠŸèƒ½ç®€ç›´æ˜¯å¤ªäººæ€§åŒ–äº†ã€‚

å®‰è£…å®Œ`Volar`ä»¥åï¼Œæ‰“å¼€ä¸€ä¸ª`.vue`æ–‡ä»¶ï¼Œçœ‹`vscode`çš„å³ä¸Šè§’ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªå›¾æ ‡ï¼Œç‚¹ä¸€ä¸‹ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49122101d2744a99a4a30928530850fd~tplv-k3u1fbpfcp-watermark.awebp)

å®ƒå°±ä¼šè‡ªåŠ¨ç»™ä½ åˆ†éš”æˆä¸‰ä¸ªé¡µé¢ï¼Œåˆ†åˆ«å¯¹åº”`template`ï¼Œ`script`å’Œ`style`ï¼Œè¿™æ ·å°±å¤ªèˆ’æœäº†æœ‰æ²¡æœ‰ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0158fc2186ac41ad85dac7966562dcb3~tplv-k3u1fbpfcp-watermark.awebp)

è¿˜æœ‰å¾ˆå¤šæ–°åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢è¿™ç¯‡æ–‡ç« 

[Volar - vueç»ˆæå¼€å‘ç¥å™¨ï¼](https://link.juejin.cn?target=https%3A%2F%2Fwww.imooc.com%2Farticle%2F317810)

## Vue 3 Snippets

æ¨èçš„ç¬¬äºŒä¸ªæ’ä»¶å«åš`Vue 3 Snippets`ï¼ŒåŒæ ·çš„ï¼Œä»–ä¹Ÿæœ‰è‡ªå·±çš„`Vue2`ç‰ˆæœ¬ã€‚å®ƒæ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™å¼ å›¾ï¼Œæˆ‘åªè¾“å…¥äº†`â€œv3â€`ï¼Œå®ƒæœ‰å¾ˆå¤šæç¤ºï¼Œæˆ‘ä»¬å°±å…ˆé€‰æ‹©`v3computed`ï¼Œé€‰ä¸­å›è½¦å³å¯ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa474130307b4b0f92ba61f8fa3da8e6~tplv-k3u1fbpfcp-watermark.awebp)

ç„¶åå®ƒå°±ç»™è‡ªåŠ¨ç»™æˆ‘ä»¬å†™äº†å¦‚ä¸‹ä»£ç 

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4dbe40a8d94c489b91751cc5b1297631~tplv-k3u1fbpfcp-watermark.awebp)

æ˜¯ä¸æ˜¯è¶…çº§çœäº‹ï¼Œæ‘¸é±¼çš„æ—¶é—´åˆå¢åŠ äº†ï¼è¿˜æœ‰æ›´å¤šæœ‰è¶£çš„ä½¿ç”¨æ–¹å¼ï¼Œå°ä¼™ä¼´ä»¬è‡ªè¡Œæ¢ç´¢å§ã€‚

# åˆ›å»ºVue3é¡¹ç›®

é‚£ä¹ˆæ­£å¼å¼€å§‹å­¦ä¹ æˆ‘ä»¬çš„`Vue3`ï¼Œå…ˆä»åˆ›å»ºé¡¹ç›®å¼€å§‹ã€‚

## ä½¿ç”¨ vue-cli åˆ›å»º

è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ç„¶åé€‰æ‹©é…ç½®é¡¹è¿›è¡Œå®‰è£…å³å¯ï¼Œè¿™é‡Œæ³¨æ„`vue-cli`çš„ç‰ˆæœ¬ä¸€å®šè¦åœ¨`4.5.0`ä»¥ä¸Š

```js
// å®‰è£…æˆ–è€…å‡çº§
npm install -g @vue/cli
//æŸ¥çœ‹ç‰ˆæœ¬ ä¿è¯ vue cli ç‰ˆæœ¬åœ¨ 4.5.0 ä»¥ä¸Š
vue --version
// åˆ›å»ºé¡¹ç›®
vue create my-project
//ç„¶åæ ¹æ®æç¤ºä¸€æ­¥ä¸€æ­¥å‚»ç“œå¼æ“ä½œå°±è¡Œäº†
...
å¤åˆ¶ä»£ç 
```

## ä½¿ç”¨ Vite åˆ›å»º

éƒ½è¯´`Vue3.0`å’Œ`Vite2`æ›´é…ï¼Œå„ç§ä¼˜åŒ–ï¼Œå„ç§å¿«ï¼Œä½†éƒ½ä¸å±äºæœ¬æ–‡çš„å†…å®¹ï¼Œæœ¬æ–‡çš„ç›®çš„æˆ‘ä»¬åªéœ€è¦çŸ¥é“å®ƒç‰¹åˆ«å¥½ç”¨ï¼Œæ€ä¹ˆç”¨å°±è¡Œäº†ã€‚æˆ‘è¿™é‡Œæ˜¯å¤šé€‰æ‹©äº†`TS`ï¼Œæ¯è¡Œéƒ½æœ‰æ³¨é‡Šï¼Œä¸€ç›®äº†ç„¶ã€‚

```js
// åˆå§‹åŒ–vieteé¡¹ç›®
npm init vite-app <project-name>
// è¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹
cd <project-name>
// å®‰è£…ä¾èµ–
npm install
//å¯åŠ¨é¡¹ç›®
npm run dev
å¤åˆ¶ä»£ç 
```

åˆ›å»ºå®Œä»¥åæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å…¥å£æ–‡ä»¶`main.ts`

```js
// å¼•å…¥createAppå‡½æ•°,åˆ›å»ºå¯¹åº”çš„åº”ç”¨,äº§ç”Ÿåº”ç”¨çš„å®ä¾‹å¯¹è±¡
import { createApp } from 'vue';
// å¼•å…¥appç»„ä»¶(æ‰€æœ‰ç»„ä»¶çš„çˆ¶çº§ç»„ä»¶)
import App from './App.vue';
// åˆ›å»ºappåº”ç”¨è¿”å›å¯¹åº”çš„å®ä¾‹å¯¹è±¡,è°ƒç”¨mountæ–¹æ³•è¿›è¡ŒæŒ‚è½½  æŒ‚è½½åˆ°#appèŠ‚ç‚¹ä¸Šå»
createApp(App).mount('#app');
å¤åˆ¶ä»£ç 
```

ç„¶åçœ‹çœ‹æ ¹ç»„ä»¶`app.vue`

```js
//Vue2ç»„ä»¶ä¸­çš„htmlæ¨¡æ¿ä¸­å¿…é¡»è¦æœ‰ä¸€å¯¹æ ¹æ ‡ç­¾,Vue3ç»„ä»¶çš„htmlæ¨¡æ¿ä¸­å¯ä»¥æ²¡æœ‰æ ¹æ ‡ç­¾
<template>
  <img alt="Vue logo" src="./assets/logo.png">
  <!-- ä½¿ç”¨å­çº§ç»„ä»¶ -->
  <HelloWorld msg="Welcome to Your Vue.js + TypeScript App" />
</template>

<script lang="ts">
// è¿™é‡Œå¯ä»¥ä¹¦å†™TSä»£ç 

// defineComponentå‡½æ•°,ç›®çš„æ˜¯å®šä¹‰ä¸€ä¸ªç»„ä»¶ å†…éƒ¨å¯ä»¥ä¼ å…¥ä¸€ä¸ªé…ç½®å¯¹è±¡
import { defineComponent } from 'vue';
//å¼•å…¥å­çº§ç»„ä»¶
import HelloWorld from './components/HelloWorld.vue';

// æš´éœ²å‡ºå»ä¸€ä¸ªå®šä¹‰å¥½çš„ç»„ä»¶
export default defineComponent({
  // å½“å‰ç»„ä»¶çš„åå­—
  name: 'App',
  // æ³¨å†Œç»„ä»¶
  components: {
    // æ³¨å†Œä¸€ä¸ªå­çº§ç»„ä»¶
    HelloWorld,
  },
});
</script>
å¤åˆ¶ä»£ç 
```

# Composition API

æ¥ä¸‹æ¥åˆ°äº†é‡å¤´æˆï¼Œ`Vue3`çš„æ‹›ç‰Œç‰¹æ€§ï¼Œ**Composition API**

å…³äº`Composition API`è¿™é‡Œæœ‰å¤§ä½¬åšçš„åŠ¨ç”»æ¼”ç¤ºï¼ŒæåŠ›æ¨èã€‚

[é‚£ä¸ªå¿™äº†ä¸€å¤œçš„Vue3åŠ¨ç”»å¾ˆå¥½ï¼Œå°±æ˜¯å¤ªçŸ­äº†](https://juejin.cn/post/6891640356543627278)

`Composition API`å¯ä»¥æ›´æ–¹ä¾¿çš„æŠ½å–å…±é€šé€»è¾‘ï¼Œä½†æ˜¯ä¸è¦è¿‡äºåœ¨æ„é€»è¾‘ä»£ç å¤ç”¨ï¼Œä»¥åŠŸèƒ½æå–ä»£ç ä¹Ÿæ˜¯ä¸€ç§æ€è·¯ã€‚

é¡ºä¾¿æä¸€å¥ï¼Œ`Vue3`å…¼å®¹å¤§éƒ¨åˆ†`Vue2`è¯­æ³•ï¼Œæ‰€ä»¥åœ¨`Vue3`ä¸­ä¹¦å†™`Vue2`è¯­æ³•æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ˆåºŸé™¤çš„é™¤å¤–ï¼‰ï¼Œä½†æ˜¯æ—¢ç„¶æˆ‘ä»¬å·²ç»å‡çº§`Vue3`äº†ï¼Œä¸å»ºè®®æ··åˆä½¿ç”¨ï¼Œé™¤éä¸€äº›å¤§å‹ç‰¹æ®Šé¡¹ç›®éœ€è¦å…¼å®¹ä¸¤ä¸ªç‰ˆæœ¬ã€‚

## setup

`setup`æ˜¯ç»„åˆ`Composition API`ä¸­çš„å…¥å£å‡½æ•°ï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªè¦ä½¿ç”¨çš„å‡½æ•°ã€‚

`setup`åªåœ¨åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€æœ‰çš„`Composition API`å‡½æ•°éƒ½åœ¨æ­¤ä½¿ç”¨ã€‚

```js
setup() {
  console.log('æˆ‘æ‰§è¡Œäº†') //æˆ‘æ‰§è¡Œäº†
},
å¤åˆ¶ä»£ç 
```

å¯ä»¥é€šè¿‡`console.log`çœ‹åˆ°`setup`æ˜¯åœ¨`beforeCreate`ç”Ÿå‘½å‘¨æœŸä¹‹å‰æ‰§è¡Œçš„(åªæ‰§è¡Œä¸€æ¬¡)

```js
  beforeCreate() {
    console.log('beforeCreateæ‰§è¡Œäº†');
  },
  setup() {
    console.log('setupæ‰§è¡Œäº†');
    return {};
  },
  //setupæ‰§è¡Œäº†
  //beforeCreateæ‰§è¡Œäº†
å¤åˆ¶ä»£ç 
```

ç”±æ­¤å¯ä»¥æ¨æ–­å‡º`setup`æ‰§è¡Œçš„æ—¶å€™,ç»„ä»¶å¯¹è±¡è¿˜æ²¡æœ‰åˆ›å»º,ç»„ä»¶å®ä¾‹å¯¹è±¡`this`è¿˜ä¸å¯ç”¨,æ­¤æ—¶`this`æ˜¯`undefined`, ä¸èƒ½é€šè¿‡`this`æ¥è®¿é—®`data/computed/methods/props`ã€‚

è¿”å›å¯¹è±¡ä¸­çš„å±æ€§ä¼šä¸`data`å‡½æ•°è¿”å›å¯¹è±¡çš„å±æ€§åˆå¹¶æˆä¸ºç»„ä»¶å¯¹è±¡çš„å±æ€§ï¼Œè¿”å›å¯¹è±¡ä¸­çš„æ–¹æ³•ä¼šä¸`methods`ä¸­çš„æ–¹æ³•åˆå¹¶æˆåŠŸç»„ä»¶å¯¹è±¡çš„æ–¹æ³•ï¼Œå¦‚æœæœ‰é‡å, `setup`ä¼˜å…ˆã€‚å› ä¸ºåœ¨`setup`ä¸­`this`ä¸å¯ç”¨ï¼Œ`methods`ä¸­å¯ä»¥è®¿é—®`setup`æä¾›çš„å±æ€§å’Œæ–¹æ³•, ä½†åœ¨`setup`æ–¹æ³•ä¸­ä¸èƒ½è®¿é—®`data`å’Œ`methods`é‡Œçš„å†…å®¹ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¸å»ºè®®æ··åˆä½¿ç”¨ã€‚

`setup`å‡½æ•°å¦‚æœè¿”å›å¯¹è±¡, å¯¹è±¡ä¸­çš„ **å±æ€§** æˆ– **æ–¹æ³•** , **æ¨¡æ¿** ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨

```js
//templete
<div>{{number}}</div>

//JS
setup() {
  const number = 18;
  return {
    number,
  };
},
å¤åˆ¶ä»£ç 
```

**æ³¨æ„ï¼š**`setup`ä¸èƒ½æ˜¯ä¸€ä¸ª`async`å‡½æ•°: å› ä¸ºè¿”å›å€¼ä¸å†æ˜¯`return`çš„å¯¹è±¡, è€Œæ˜¯`promise`, æ¨¡æ¿ä¸­å°±ä¸å¯ä»¥ä½¿ç”¨`return`ä¸­è¿”å›å¯¹è±¡çš„æ•°æ®äº†ã€‚

### setupçš„å‚æ•°(props,context)`

**props**: æ˜¯ä¸€ä¸ªå¯¹è±¡,é‡Œé¢æœ‰çˆ¶çº§ç»„ä»¶å‘å­çº§ç»„ä»¶ä¼ é€’çš„æ•°æ®,å¹¶ä¸”æ˜¯åœ¨å­çº§ç»„ä»¶ä¸­ä½¿ç”¨`props`æ¥æ”¶åˆ°çš„æ‰€æœ‰çš„å±æ€§

**context**ï¼šä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡`es6`è¯­æ³•è§£æ„` setup(props, {attrs, slots, emit})`

- **attrs**: è·å–å½“å‰ç»„ä»¶æ ‡ç­¾ä¸Šæ‰€æœ‰æ²¡æœ‰é€šè¿‡`props`æ¥æ”¶çš„å±æ€§çš„å¯¹è±¡, ç›¸å½“äº `this.$attrs`
- **slots**: åŒ…å«æ‰€æœ‰ä¼ å…¥çš„æ’æ§½å†…å®¹çš„å¯¹è±¡, ç›¸å½“äº` this.$slots`
- **emit**: ç”¨æ¥åˆ†å‘è‡ªå®šä¹‰äº‹ä»¶çš„å‡½æ•°, ç›¸å½“äº `this.$emit`

æ¼”ç¤º`attrs`å’Œ`props`

```js
//çˆ¶ç»„ä»¶
<template>
  <child :msg="msg" msg2='å“ˆå“ˆå“ˆ' />
</template>
<script lang='ts'>
import { defineComponent, ref } from 'vue';
// å¼•å…¥å­ç»„ä»¶
import Child from './components/Child.vue';
export default defineComponent({
  name: 'App',
  components: {
    Child,
  },
  setup() {
    const msg = ref('hello,vue3');
    return {
      msg,
    };
  },
});
</script>

//å­ç»„ä»¶
<template>
  <h2>å­ç»„ä»¶</h2>
  <h3>msg:{{ msg }}</h3>
</template>

<script lang='ts'>
import { defineComponent } from 'vue';
export default defineComponent({
  name: 'Child',
  props: ['msg'],
  setup(props, {attrs, slots, emit}) {
    console.log('props:', props);//msg: "hello,vue3"
    console.log('attrs:', attrs);//msg2: "å“ˆå“ˆå“ˆ"
    return {};
  },
});
</script>
å¤åˆ¶ä»£ç 
```

æ¼”ç¤º`emit`

```js
//çˆ¶ç»„ä»¶
<template>
  <child @show="show" />
</template>

<script lang='ts'>
  setup() {
    const show = () => {
      console.log('name:', 'hzw');
    };
    return {
      show,
    };
  },
</script>

//å­ç»„ä»¶
<template>
  <button @click='emitFn'>äº‹ä»¶åˆ†å‘</button>
</template>
<script lang='ts'>
import { defineComponent } from 'vue';

export default defineComponent({
  name: 'Child',
  setup(props, { emit }) {
    const emitFn = () => {
      emit('show');
    };
    return {
      emitFn,
    };
  },
});
</script>
å¤åˆ¶ä»£ç 
```

## ref

### ä½œç”¨

å®šä¹‰ä¸€ä¸ªå“åº”å¼çš„æ•°æ®(ä¸€èˆ¬ç”¨æ¥å®šä¹‰ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„å“åº”å¼æ•°æ®`Undefined`ã€`Null`ã€`Boolean`ã€`Number`å’Œ`String`)

### è¯­æ³•

```js
const xxx = ref(initValue):
å¤åˆ¶ä»£ç 
```

**æ³¨æ„**ï¼š`script`ä¸­æ“ä½œæ•°æ®éœ€è¦ä½¿ç”¨`xxx.value`çš„å½¢å¼ï¼Œè€Œæ¨¡æ¿ä¸­ä¸éœ€è¦æ·»åŠ `.value`

ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºï¼šå®ç°ä¸€ä¸ªæŒ‰é’®,ç‚¹å‡»å¯ä»¥å¢åŠ æ•°å­—

```js
<template>
  <div>{{count}}</div>
  <button @click='updateCount'>å¢åŠ </button>
</template>
å¤åˆ¶ä»£ç 
```

**åœ¨Vue2ä¸­**

```js
data() {
  return {
    conunt: 0,
  };
},
methods: {
  updateCount() {
    this.conunt++;
  },
},
å¤åˆ¶ä»£ç 
```

**åœ¨Vue3ä¸­**

```js
 setup() {
    // refç”¨äºå®šä¹‰ä¸€ä¸ªå“åº”å¼çš„æ•°æ®ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªRefå¯¹è±¡ï¼Œå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªvalueå±æ€§
    //å¦‚æœéœ€è¦å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œéœ€è¦ä½¿ç”¨è¯¥Refå¯¹è±¡çš„valueå±æ€§
    const count = ref(0);
    function updateCount() {
      count.value++;
    }
    return {
      count,
      updateCount,
    };
  },
å¤åˆ¶ä»£ç 
```

åœ¨`Vue2`ä¸­æˆ‘ä»¬é€šè¿‡`this.$refs`æ¥è·å–`dom`èŠ‚ç‚¹ï¼Œ`Vue3`ä¸­æˆ‘ä»¬é€šè¿‡`ref`æ¥è·å–èŠ‚ç‚¹

é¦–å…ˆéœ€è¦åœ¨æ ‡ç­¾ä¸Šæ·»åŠ `ref='xxx'`ï¼Œç„¶åå†`setup`ä¸­å®šä¹‰ä¸€ä¸ªåˆå§‹å€¼ä¸º`null`çš„`ref`ç±»å‹,åå­—è¦å’Œæ ‡ç­¾çš„`ref`å±æ€§ä¸€è‡´

```js
const xxx = ref(null)
å¤åˆ¶ä»£ç 
```

**æ³¨æ„**ï¼šä¸€å®šè¦åœ¨`setup`çš„`return`ä¸­è¿”å›ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚

è¿˜æ˜¯ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤º:è®©è¾“å…¥æ¡†è‡ªåŠ¨è·å–ç„¦ç‚¹

```ts
<template>
  <h2>App</h2>
  <input type="text">---
  <input type="text" ref="inputRef">
</template>

<script lang="ts">
import { onMounted, ref } from 'vue'
/* 
refè·å–å…ƒç´ : åˆ©ç”¨refå‡½æ•°è·å–ç»„ä»¶ä¸­çš„æ ‡ç­¾å…ƒç´ 
åŠŸèƒ½éœ€æ±‚: è®©è¾“å…¥æ¡†è‡ªåŠ¨è·å–ç„¦ç‚¹
*/
export default {
  setup() {
    const inputRef = ref<HTMLElement|null>(null)

    onMounted(() => {
      inputRef.value && inputRef.value.focus()
    })

    return {
      inputRef
    }
  },
}
</script>
å¤åˆ¶ä»£ç 
```

## reactive

### è¯­æ³•

```js
const proxy = reactive(obj)
å¤åˆ¶ä»£ç 
```

### ä½œç”¨

å®šä¹‰å¤šä¸ªæ•°æ®çš„å“åº”å¼ï¼Œæ¥æ”¶ä¸€ä¸ªæ™®é€šå¯¹è±¡ç„¶åè¿”å›è¯¥æ™®é€šå¯¹è±¡çš„å“åº”å¼ä»£ç†å™¨å¯¹è±¡`(Proxy)`ï¼Œå“åº”å¼è½¬æ¢æ˜¯â€œæ·±å±‚çš„â€ï¼šä¼šå½±å“å¯¹è±¡å†…éƒ¨æ‰€æœ‰åµŒå¥—çš„å±æ€§,æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å“åº”å¼çš„ã€‚

### ä»£ç æ¼”ç¤º

```js
<template>
  <h3>å§“å:{{user.name}}</h3>
  <h3>å¹´é¾„:{{user.age}}</h3>
  <h3>wife:{{user.wife}}</h3>
  <button @click="updateUser">æ›´æ–°</button>
</template>

 setup() {
    const user = reactive({
      name: 'hzw',
      age: 18,
      wife: {
        name: 'xioaohong',
        age: 18,
        books: ['çº¢å®ä¹¦', 'è®¾è®¡æ¨¡å¼', 'ç®—æ³•ä¸æ•°æ®ç»“æ„'],
      },
    });
    const updateUser = () => {
      user.name = 'å°çº¢';
      user.age += 2;
      user.wife.books[0] = 'é‡‘ç“¶æ¢…';
    };
    return {
      user,
      updateUser,
    };
  },
å¤åˆ¶ä»£ç 
```

## computedå‡½æ•°:

ä¸`Vue2`ä¸­çš„`computed`é…ç½®åŠŸèƒ½ä¸€è‡´ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª`ref`ç±»å‹çš„å¯¹è±¡

è®¡ç®—å±æ€§çš„å‡½æ•°ä¸­å¦‚æœåªä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•° è¡¨ç¤ºçš„æ˜¯`get`æ“ä½œ

```ts
import { computed } from 'vue';
const user = reactive({
  firstName: 'éŸ©',
  lastName: 'å¿—ä¼Ÿ',
});
const fullName1 = computed(() => {
  return user.firstName + user.lastName;
});
return {
  user,
  fullName1,
};
å¤åˆ¶ä»£ç 
```

è®¡ç®—å±æ€§çš„å‡½æ•°ä¸­å¯ä»¥ä¼ å…¥ä¸€ä¸ªå¯¹è±¡,å¯ä»¥åŒ…å«`set`å’Œ`get`å‡½æ•°,è¿›è¡Œè¯»å–å’Œä¿®æ”¹çš„æ“ä½œ

```js
const fullName2 = computed({
  get() {
    return user.firstName + '_' + user.lastName;
  },
  set(val: string) {
    const names = val.split('_');
    user.firstName = names[0];
    user.lastName = names[1];
  },
});
return {
  user,
  fullName2,
};
å¤åˆ¶ä»£ç 
```

## watchå‡½æ•°:

ä¸`Vue2`ä¸­çš„`watch`é…ç½®åŠŸèƒ½ä¸€è‡´,

- å‚æ•°1:è¦ç›‘å¬çš„æ•°æ®
- å‚æ•°2:å›è°ƒå‡½æ•°
- å‚æ•°3:é…ç½®

### ä½œç”¨

ç›‘è§†æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªå“åº”å¼æ•°æ®, ä¸€æ—¦æ•°æ®å˜åŒ–, å°±è‡ªåŠ¨æ‰§è¡Œç›‘è§†å›è°ƒ

é»˜è®¤åˆå§‹æ—¶ä¸æ‰§è¡Œå›è°ƒ, ä½†å¯ä»¥é€šè¿‡é…ç½®`immediate`ä¸º`true`, æ¥æŒ‡å®šåˆå§‹æ—¶ç«‹å³æ‰§è¡Œç¬¬ä¸€æ¬¡

é€šè¿‡é…ç½®`deep`ä¸º`true`, æ¥æŒ‡å®šæ·±åº¦ç›‘è§†

```js
import { watch, ref } from 'vue';
const user = reactive({
  firstName: 'éŸ©',
  lastName: 'å¿—ä¼Ÿ',
});
const fullName3 = ref('');
watch(
  user,
  ({ firstName, lastName }) => {
    fullName3.value = firstName + '_' + lastName;
  },
  { immediate: true, deep: true }
);
return {
  user,
  fullName3,
};
å¤åˆ¶ä»£ç 
```

`watch`ç›‘å¬å¤šä¸ªæ•°æ®,ä½¿ç”¨æ•°ç»„

`watch`ç›‘å¬éå“åº”å¼æ•°æ®çš„æ—¶å€™éœ€è¦ä½¿ç”¨å›è°ƒå‡½æ•°çš„å½¢å¼

```js
watch([()=>user.firstName,()=>user.lastName,fullName3],()=>{console.log('æˆ‘æ‰§è¡Œäº†')})
å¤åˆ¶ä»£ç 
```

## watchEffectå‡½æ•°:

### ä½œç”¨

ç›‘è§†æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œå›è°ƒï¼Œä¸ç”¨ç›´æ¥æŒ‡å®šè¦ç›‘è§†çš„æ•°æ®, å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨çš„å“ªäº›å“åº”å¼æ•°æ®å°±ç›‘è§†å“ªäº›å“åº”å¼æ•°æ®ï¼Œé»˜è®¤åˆå§‹æ—¶å°±ä¼šæ‰§è¡Œç¬¬ä¸€æ¬¡, ä»è€Œå¯ä»¥æ”¶é›†éœ€è¦ç›‘è§†çš„æ•°æ®ã€‚

```js
import { watchEffect, ref } from 'vue';
const user = reactive({
  firstName: 'éŸ©',
  lastName: 'å¿—ä¼Ÿ',
});
const fullName4 = ref('');
watchEffect(() => {
  fullName4.value = user.firstName + '_' + user.lastName;
});
return {
  user,
  fullName4,
};
watchEffectå¯ä»¥å®ç°è®¡ç®—å±æ€§setæ–¹æ³•
watchEffect(() => {
    const names = fullName3.value.split('_');
    user.firstName = names[0];
    user.lastName = names[1];
});
å¤åˆ¶ä»£ç 
```

## ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”:

![å¾®ä¿¡æˆªå›¾_20210623104108.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8f719bf10544f109cd10e5ba6adbcda~tplv-k3u1fbpfcp-watermark.awebp)

**æ³¨æ„**:`3.0`ä¸­çš„ç”Ÿå‘½å‘¨æœŸé’©å­è¦æ¯”`2.X`ä¸­ç›¸åŒç”Ÿå‘½å‘¨æœŸçš„é’©å­è¦å¿«

`Composition API`è¿˜æ–°å¢äº†ä»¥ä¸‹è°ƒè¯•é’©å­å‡½æ•°ï¼šä½†æ˜¯ä¸æ€ä¹ˆå¸¸ç”¨

- onRenderTracked
- onRenderTriggered

### ä»£ç æ¼”ç¤º

```js
setup() {

  onBeforeMount(() => {
    console.log('--onBeforeMount')
  })

  onMounted(() => {
    console.log('--onMounted')
  })

  onBeforeUpdate(() => {
    console.log('--onBeforeUpdate')
  })

  onUpdated(() => {
    console.log('--onUpdated')
  })

  onBeforeUnmount(() => {
    console.log('--onBeforeUnmount')
  })

  onUnmounted(() => {
    console.log('--onUnmounted')
  })
}
å¤åˆ¶ä»£ç 
```

## toRefs

### ä½œç”¨

æŠŠä¸€ä¸ªå“åº”å¼å¯¹è±¡è½¬æ¢æˆæ™®é€šå¯¹è±¡ï¼Œè¯¥æ™®é€šå¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½æ˜¯ä¸€ä¸ª` ref`

### åº”ç”¨

æˆ‘ä»¬ä½¿ç”¨`reactive`åˆ›å»ºçš„å¯¹è±¡ï¼Œå¦‚æœæƒ³åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œå°±å¿…é¡»å¾—ä½¿ç”¨`xxx.xxx`çš„å½¢å¼,å¦‚æœå¤§é‡ç”¨åˆ°çš„è¯è¿˜æ˜¯å¾ˆéº»çƒ¦çš„,ä½†æ˜¯ä½¿ç”¨`es6`è§£æ„ä»¥å,ä¼šå¤±å»å“åº”å¼,é‚£ä¹ˆ`toRefs`çš„ä½œç”¨å°±ä½“ç°åœ¨è¿™,ï¼Œåˆ©ç”¨`toRefs`å¯ä»¥å°†ä¸€ä¸ªå“åº”å¼ `reactive `å¯¹è±¡çš„æ‰€æœ‰åŸå§‹å±æ€§è½¬æ¢ä¸ºå“åº”å¼çš„`ref`å±æ€§ã€‚å½“ç„¶å°ä¼™ä¼´ä»¬å¯ä»¥è‡ªè¡Œå¼€å‘æ›´å¤šåº”ç”¨åœºæ™¯ã€‚

### ä»£ç æ¼”ç¤º

```js
<template>
  <div>
    name:{{name}}
  </div>
</template>

<script lang='ts'>
import { defineComponent, reactive, toRefs } from 'vue';

export default defineComponent({
  name: '',
  setup() {
    const state = reactive({
      name: 'hzw',
    });
    const state2 = toRefs(state);
    setInterval(() => {
      state.name += '===';
    }, 1000);
    return {
      //é€šè¿‡toRefsè¿”å›çš„å¯¹è±¡,è§£æ„å‡ºæ¥çš„å±æ€§ä¹Ÿæ˜¯å“åº”å¼çš„
      ...state2,
    };
  },
});
</script>
å¤åˆ¶ä»£ç 
```

## provide ä¸ inject

### ä½œç”¨

å®ç°è·¨å±‚çº§ç»„ä»¶(ç¥–å­™)é—´é€šä¿¡

### ä»£ç æ¼”ç¤º

çˆ¶ç»„ä»¶

```js
<template>
  <h1>çˆ¶ç»„ä»¶</h1>
  <p>å½“å‰é¢œè‰²: {{color}}</p>
  <button @click="color='red'">çº¢</button>
  <button @click="color='yellow'">é»„</button>
  <button @click="color='blue'">è“</button>
  <hr>
  <Son />
</template>
<script lang="ts">
import { provide, ref } from 'vue'
import Son from './Son.vue'
export default {
  name: 'ProvideInject',
  components: {
    Son
  },
  setup() {
    const color = ref('red')
    provide('color', color)
    return {
      color
    }
  }
}
</script>
å¤åˆ¶ä»£ç 
```

å­ç»„ä»¶

```js
<template>
  <div>
    <h2>å­ç»„ä»¶</h2>
    <hr>
    <GrandSon />
  </div>
</template>

<script lang="ts">
import GrandSon from './GrandSon.vue'
export default {
  components: {
    GrandSon
  },
}
</script>
å¤åˆ¶ä»£ç 
```

å­™å­ç»„ä»¶

```js
<template>
  <h3 :style="{color}">å­™å­ç»„ä»¶: {{color}}</h3>
</template>

<script lang="ts">
import { inject } from 'vue'
export default {
  setup() {
    const color = inject('color')
    return {
      color
    }
  }
}
</script>
å¤åˆ¶ä»£ç 
```

# å…¶ä»–ç‰¹æ€§

## Teleport(ç¬ç§»)

### ä½œç”¨

`Teleport` æä¾›äº†ä¸€ç§å¹²å‡€çš„æ–¹æ³•, è®©ç»„ä»¶çš„`html`åœ¨çˆ¶ç»„ä»¶ç•Œé¢å¤–çš„ç‰¹å®šæ ‡ç­¾(å¾ˆå¯èƒ½æ˜¯`body`)ä¸‹æ’å…¥æ˜¾ç¤º æ¢å¥è¯è¯´å°±æ˜¯å¯ä»¥æŠŠ **å­ç»„ä»¶** æˆ–è€… **domèŠ‚ç‚¹** æ’å…¥åˆ°ä»»ä½•ä½ æƒ³æ’å…¥åˆ°çš„åœ°æ–¹å»ã€‚

### è¯­æ³•

ä½¿ç”¨`to`å±æ€§ å¼•å·å†…ä½¿ç”¨é€‰æ‹©å™¨

```js
  <teleport to="body">
  </teleport>
å¤åˆ¶ä»£ç 
```

### ä»£ç æ¼”ç¤º

```js
//çˆ¶ç»„ä»¶

<template>
  <div class="father">
    <h2>App</h2>
    <modal-button></modal-button>
  </div>
</template>

<script lang="ts">
import ModalButton from './components/ModalButton.vue'
export default {
  setup() {
    return {}
  },
  components: {
    ModalButton,
  },
}
</script>


//å­ç»„ä»¶
<template>
  <div class="son">
    <button @click="modalOpen = true">
      ç‚¹æˆ‘æ‰“å¼€å¯¹è¯æ¡†
    </button>

    <teleport to="body">
      <div v-if="modalOpen"
           class="looklook">
        çœ‹çœ‹æˆ‘å‡ºç°åœ¨äº†å“ªé‡Œ
        <button @click="modalOpen = false">
          Close
        </button>
      </div>
    </teleport>
  </div>
</template>

<script>
import { ref } from 'vue'
export default {
  name: 'modal-button',
  setup() {
    const modalOpen = ref(false)
    return {
      modalOpen,
    }
  },
}
</script>
å¤åˆ¶ä»£ç 
```

å¯ä»¥çœ‹åˆ°åœ¨å­ç»„ä»¶ä¸­çš„`looklook`å…ƒç´ è·‘åˆ°äº†`body`ä¸‹é¢,è€Œä¹‹å‰çš„ä½ç½®é»˜è®¤å‡ºç°äº†ä¸¤è¡Œæ³¨é‡Š

![å¾®ä¿¡æˆªå›¾_20210623170701.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e0dcee48f2442628aa0f09d5324e72b~tplv-k3u1fbpfcp-watermark.awebp)

## Suspense(ä¸ç¡®å®šçš„)

### ä½œç”¨

å®ƒä»¬å…è®¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨ç­‰å¾…å¼‚æ­¥ç»„ä»¶æ—¶æ¸²æŸ“ä¸€äº›åå¤‡å†…å®¹ï¼Œå¯ä»¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¹³æ»‘çš„ç”¨æˆ·ä½“éªŒ

### è¯­æ³•

```js
 <Suspense>
    <template v-slot:default>
      <!-- å¼‚æ­¥ç»„ä»¶ -->
      <AsyncComp />
    </template>

    <template v-slot:fallback>
      <!-- åå¤‡å†…å®¹ -->
      <h1>LOADING...</h1>
    </template>
  </Suspense>
å¤åˆ¶ä»£ç 
```

`vue3`ä¸­å¼•å…¥å¼‚æ­¥ç»„ä»¶çš„æ–¹å¼

```js
const AsyncComp = defineAsyncComponent(() => import('./AsyncComp.vue'))
å¤åˆ¶ä»£ç 
```

### ä»£ç æ¼”ç¤º

çˆ¶ç»„ä»¶

```js
<template>
  <Suspense>
     <!-- v-slot:defaulå¯ä»¥ç®€å†™æˆ#defaul -->
    <template v-slot:default>
      <AsyncComp/>
    </template>

    <template v-slot:fallback>
      <h1>LOADING...</h1>
    </template>
  </Suspense>
</template>

<script lang="ts">
import { defineAsyncComponent } from 'vue'
const AsyncComp = defineAsyncComponent(() => import('./AsyncComp.vue'))
export default {
  setup() {
    return {
    }
  },

  components: {
    AsyncComp,
  }
}
</script>
å¤åˆ¶ä»£ç 
```

å­ç»„ä»¶

```js
<template>
  <h2>AsyncComp22</h2>
  <p>{{msg}}</p>
</template>

<script lang="ts">
export default {
  name: 'AsyncComp',
  setup () {
     return new Promise((resolve, reject) => {
       setTimeout(() => {
         resolve({
           msg: 'abc'
         })
       }, 2000)
     })
  }
}
</script>

å¤åˆ¶ä»£ç 
```

é€šè¿‡ä¸‹å›¾å¯ä»¥çœ‹åˆ°åœ¨å¼‚æ­¥ç»„ä»¶åŠ è½½å‡ºæ¥ä¹‹å‰,æ˜¾ç¤ºçš„æ˜¯`fallback`ä¸­çš„å†…å®¹

![16.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82b53c8149864d4c9d753df54df2f643~tplv-k3u1fbpfcp-watermark.awebp)

## å“åº”å¼æ•°æ®çš„åˆ¤æ–­

### ä½œç”¨

- **isRef**: æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºä¸€ä¸ª `ref` å¯¹è±¡
- **isReactive**: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± `reactive` åˆ›å»ºçš„å“åº”å¼ä»£ç†
- **isReadonly**: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± `readonly` åˆ›å»ºçš„åªè¯»ä»£ç†
- **isProxy**: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± `reactive` æˆ–è€… `readonly` æ–¹æ³•åˆ›å»ºçš„ä»£ç†

### ä»£ç æ¼”ç¤º

```js
setup() {
    const state1 = ref(1);
    console.log('isref:', isRef(state1));//isref: true
    const state2 = reactive({});
    console.log('isReactive:', isReactive(state2));//isReactive: true
    const state3 = readonly({});
    console.log('isReadonly:', isReadonly(state3));//isReadonly: true
    const state4 = reactive({});
    console.log('isProxy:', isProxy(state2));//isProxy: true
    console.log('isProxy:', isProxy(state4));//isProxy: true
    return {};
  },
å¤åˆ¶ä»£ç 
```

## å…¶ä»–ä¸å¸¸ç”¨ç‰¹æ€§

è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šä¸å¸¸ç”¨çš„æ–°ç‰¹æ€§ï¼Œæˆ‘åœ¨æ—¥å¸¸å¼€å‘ä¸­æ˜¯æ²¡æœ‰ç”¨åˆ°çš„ï¼Œå¾ˆå¤šéƒ½æ˜¯ç”¨æ¥åšä¼˜åŒ–çš„ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´ä»¬è‡ªè¡Œå»å®˜ç½‘æŸ¥çœ‹ï¼Œæˆ–è€…å¤§ä½¬ä»¬å¯ä»¥ä»‹ç»ä¸€ä¸‹åº”ç”¨åœºæ™¯ã€‚

- shallowReactive
- shallowRef
- readonly
- shallowReadonly
- markRaw
- customRef
- ...

# è¯­æ³•ç³–

è™½ç„¶`Composition API`ç”¨èµ·æ¥å·²ç»éå¸¸æ–¹ä¾¿äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æœ‰å¾ˆçƒ¦çš„åœ°æ–¹ï¼Œæ¯”å¦‚

- ç»„ä»¶å¼•å…¥äº†è¿˜è¦æ³¨å†Œ
- å±æ€§å’Œæ–¹æ³•éƒ½è¦åœ¨`setup`å‡½æ•°ä¸­è¿”å›ï¼Œæœ‰çš„æ—¶å€™ä»…ä¸€ä¸ª`return`å°±åå‡ è¡Œç”šè‡³å‡ åè¡Œ
- ...
- ä¸æƒ³å†™å•Šæ€ä¹ˆåŠ

å¥½åŠï¼Œ`Vue3`å®˜æ–¹æä¾›äº†`script setup`è¯­æ³•ç³–

åªéœ€è¦åœ¨`script`æ ‡ç­¾ä¸­æ·»åŠ `setup`ï¼Œç»„ä»¶åªéœ€å¼•å…¥ä¸ç”¨æ³¨å†Œï¼Œå±æ€§å’Œæ–¹æ³•ä¹Ÿä¸ç”¨è¿”å›ï¼Œ`setup`å‡½æ•°ä¹Ÿä¸éœ€è¦ï¼Œç”šè‡³`export default`éƒ½ä¸ç”¨å†™äº†ï¼Œä¸ä»…æ˜¯æ•°æ®ï¼Œè®¡ç®—å±æ€§å’Œæ–¹æ³•ï¼Œç”šè‡³æ˜¯è‡ªå®šä¹‰æŒ‡ä»¤ä¹Ÿå¯ä»¥åœ¨æˆ‘ä»¬çš„`template`ä¸­è‡ªåŠ¨è·å¾—ã€‚

ä½†æ˜¯è¿™ä¹ˆè¿‡ç˜¾çš„è¯­æ³•ç³–ï¼Œè¿˜æ˜¯ç¨å¾®æ·»åŠ äº†ä¸€ç‚¹ç‚¹å¿ƒæ™ºè´Ÿæ‹…ï¼Œå› ä¸ºæ²¡æœ‰äº†`setup`å‡½æ•°ï¼Œé‚£ä¹ˆ`props`ï¼Œ`emit`ï¼Œ`attrs`æ€ä¹ˆè·å–å‘¢ï¼Œå°±è¦ä»‹ç»ä¸€ä¸‹æ–°çš„è¯­æ³•äº†ã€‚

```
setup script`è¯­æ³•ç³–æä¾›äº†ä¸‰ä¸ªæ–°çš„`API`æ¥ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼š`defineProps`ã€`defineEmit`å’Œ`useContext
```

- **defineProps** ç”¨æ¥æ¥æ”¶çˆ¶ç»„ä»¶ä¼ æ¥çš„å€¼`props`ã€‚
- **defineEmit**   ç”¨æ¥å£°æ˜è§¦å‘çš„äº‹ä»¶è¡¨ã€‚
- **useContext**  ç”¨æ¥è·å–ç»„ä»¶ä¸Šä¸‹æ–‡`context`ã€‚

## ä»£ç æ¼”ç¤º

çˆ¶ç»„ä»¶

```js
<template>
  <div>
    <h2>æˆ‘æ˜¯çˆ¶ç»„ä»¶ï¼</h2>
    <Child msg="hello"
           @child-click="handleClick" />
  </div>
</template>

<script setup>
import Child from './components/Child.vue'

const handleClick = (ctx) => {
  console.log(ctx)
}
</script>
å¤åˆ¶ä»£ç 
```

å­ç»„ä»¶

```js
<template>
  <span @click="sonClick">msg: {{ props.msg }}</span>
</template>

<script setup>
import { useContext, defineProps, defineEmit } from 'vue'

const emit = defineEmit(['child-click'])
const ctx = useContext()
const props = defineProps({
  msg: String,
})

const sonClick = () => {
  emit('child-click', ctx)
}
</script>

å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬ç‚¹å‡»ä¸€ä¸‹å­ç»„ä»¶ ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/65be1cc7480d4fcaa69f4961f3cc2624~tplv-k3u1fbpfcp-watermark.awebp) å¯ä»¥çœ‹åˆ°`context`è¢«æ‰“å°äº†å‡ºæ¥ï¼Œå…¶ä¸­çš„`attrs`ã€`emit`ã€`slots`ã€`expose`å±æ€§å’Œæ–¹æ³•ä¾ç„¶å¯ä»¥ä½¿ç”¨ã€‚ `props`ä¹Ÿå¯ä»¥è¾“å‡ºåœ¨é¡µé¢ä¸Šï¼Œäº‹ä»¶ä¹ŸæˆåŠŸæ´¾å‘ã€‚

# å…¶ä»–çŸ¥è¯†ç‚¹

æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹æˆ‘ä½¿ç”¨`Vue3`è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜æˆ–è€…å°æŠ€å·§ï¼Œä¸å…¨é¢ï¼Œæƒ³èµ·ä»€ä¹ˆå°±å†™ä»€ä¹ˆå§

## script setupè¯­æ³•ç³–è¯·æ³¨æ„

å¦‚æœåœ¨çˆ¶ç»„ä»¶ä¸­é€šè¿‡`ref='xxx'`çš„æ–¹æ³•æ¥è·å–å­ç»„ä»¶å®ä¾‹ï¼Œå­ç»„ä»¶ä½¿ç”¨äº†`script setup`è¯­æ³•ç³–,é‚£ä¹ˆå­ç»„ä»¶çš„æ•°æ®éœ€è¦ç”¨exposeçš„æ–¹å¼å¯¼å‡ºï¼Œå¦åˆ™ä¼šå› ä¸ºè·å–ä¸åˆ°æ•°æ®è€ŒæŠ¥é”™ã€‚

### ä»£ç æ¼”ç¤º

çˆ¶ç»„ä»¶

```js
<template>
  <div>
    <h2>æˆ‘æ˜¯çˆ¶ç»„ä»¶ï¼</h2>
    <Child ref='son' />
  </div>
</template>

<script setup>
import Child from './components/Child.vue'
import { ref } from 'vue'
const son = ref(null)
console.log('ğŸš€ğŸš€~ son:', son)
</script>
å¤åˆ¶ä»£ç 
```

å­ç»„ä»¶å…ˆä¸ä½¿ç”¨è¯­æ³•ç³–

```js
<template>
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶{{msg}}
  </div>
</template>

<script >
import { ref } from 'vue'

export default {
  setup() {
    const msg = ref('hello')
    return {
      msg,
    }
  },
}
å¤åˆ¶ä»£ç 
```

å¯ä»¥çœ‹åˆ°æ˜¯å¯ä»¥è·å–åˆ°æˆ‘ä»¬åœ¨å­ç»„ä»¶ä¸­å®šä¹‰çš„`msg`å±æ€§çš„

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/350f7c685ceb48a4a8952d194d93b5ce~tplv-k3u1fbpfcp-watermark.awebp) ç°åœ¨æŠŠå­ç»„ä»¶æ¢æˆ`script setup`è¯­æ³•ç³–å†æ¥è¯•ä¸€è¯•

```js
<template>
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶{{msg}}
  </div>
</template>

<script setup>
import { ref } from 'vue'
const msg = ref('hello')
</script>

å¤åˆ¶ä»£ç 
```

å¯ä»¥çœ‹åˆ°ç°åœ¨æ˜¯è·å–ä¸åˆ°å­ç»„ä»¶å®šä¹‰çš„`msg`å±æ€§çš„

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/634bc9ae90a445d5bac9a84620c03807~tplv-k3u1fbpfcp-watermark.awebp)

æˆ‘ä»¬å¯ä»¥çœ‹çœ‹å°¤å¤§å¤§æ€ä¹ˆè¯´

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ddaeb54b94b489c9262923b838d2b73~tplv-k3u1fbpfcp-watermark.awebp)

> è¡¥å……è‡ªè¯„è®ºåŒº **ç”¨æˆ·2150817567886** setupè¯­æ³•ç³–å®šä¹‰çš„ç»„ä»¶é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å¯¹å¤–å¼€å‘å†…éƒ¨è°ƒç”¨çš„ï¼Œå®ƒéœ€è¦ç”¨expose()å‡½æ•°æ¥å®šä¹‰å“ªäº›æ•°æ®å…è®¸å¯¹å¤–å¼€æ”¾ï¼Œ[å…·ä½“å†…å®¹å‚è€ƒ](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Frfcs%2Fpull%2F210)

## Emitæ´¾å‘äº‹ä»¶å¯ä»¥å¯¹å‚æ•°è¿›è¡ŒéªŒè¯

çˆ¶ç»„ä»¶

```js
<template>
  <div>
    <h2>æˆ‘æ˜¯çˆ¶ç»„ä»¶ï¼</h2>
    <Child @sonClick='sonClick' />
  </div>
</template>

<script setup>
import Child from './components/Child.vue'
import { ref } from 'vue'
const sonClick = (value) => {
  console.log(value)
}
</script>
å¤åˆ¶ä»£ç 
```

å­ç»„ä»¶

```js
<template>
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶{{ msg }}
  </div>
  <button @click="handleClick(1)">æˆ‘æ˜¯æŒ‰é’®1</button>
  <button @click="handleClick(2)">æˆ‘æ˜¯æŒ‰é’®2</button>
</template>

<script>
import { ref } from 'vue'
export default {
  name: '',
  emits: {
    sonClick: (value) => {
      if (value === 1) {
        return true
      } else {
        return false
      }
    },
  },
  setup(props, { emit }) {
    const msg = ref('hello')
    const handleClick = (value) => {
      emit('sonClick', value)
    }
    return {
      msg,
      handleClick,
    }
  },
}
</script>
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬åˆ†åˆ«ç‚¹ä¸€ä¸‹æŒ‰é’®1å’ŒæŒ‰é’®2ï¼Œå¯ä»¥çœ‹åˆ°å½“æˆ‘ä»¬ç‚¹äº†æŒ‰é’®2çš„æ—¶å€™ï¼Œæ§åˆ¶å°ä¼šå‘å‡ºè­¦å‘Šï¼Œä½†æ˜¯ç¨‹åºä¼šç»§ç»­æ‰§è¡Œï¼Œè¿˜æ²¡æƒ³åˆ°ä»€ä¹ˆé€‚åˆçš„åº”ç”¨åœºæ™¯ï¼Œä½†æ˜¯è¦çŸ¥é“è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥åœ¨è¿™æäº‹æƒ…ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/60478b16b7fb4493ae7d0d5868e3aaa2~tplv-k3u1fbpfcp-watermark.awebp)

## è·¨ç»„ä»¶é€šè®¯mitt.js

`Vue2`ä¸­æ€ä¹ˆå®ç°è·¨ç»„ä»¶é€šè®¯å‘¢,å¾ˆå¤šäººç¬¬ä¸€æƒ³æ³•å°±æ˜¯`event bus`ã€‚ä½†æ˜¯`Vue3`ç§»é™¤äº†`$on`,`$once`,`$off`å¯¼è‡´ä¸èƒ½ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯`Vue`å®˜æ–¹ç»™å¤§å®¶æ¨èäº†`mitt.js`,å®ƒçš„åŸç†å°±æ˜¯`event bus`ã€‚

### ä»£ç æ¼”ç¤º

å…ˆå®‰è£…

```js
npm i mitt -s
å¤åˆ¶ä»£ç 
```

ç„¶åå°è£…ä¸€ä¸ª`hook`

```js
//mitt.js
import mitt from 'mitt'
const emitter = mitt();

export default emitter;
å¤åˆ¶ä»£ç 
```

çˆ¶ç»„ä»¶

```js
<template>
  <div>
    <h2>æˆ‘æ˜¯çˆ¶ç»„ä»¶ï¼</h2>
    <Child1 />
    <Child2 />

  </div>
</template>

<script setup>
import Child1 from './components/Child1.vue'
import Child2 from './components/Child2.vue'
</script>
å¤åˆ¶ä»£ç 
```

å­ç»„ä»¶1

```js
<template>
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶1
    <h1>{{msg}}</h1>
  </div>
</template>

<script>
import { ref, onUnmounted } from 'vue'
import emitter from '../mitt'
export default {
  name: '',

  setup() {
    //åˆå§‹åŒ–
    const msg = ref('hello')
    const changeMsg = () => {
      msg.value = 'world'
    }
    // ç›‘å¬äº‹ä»¶,æ›´æ–°æ•°æ®
    emitter.on('change-msg', changeMsg)
    // æ˜¾å¼å¸è½½
    onUnmounted(() => {
      emitter.off('change-msg', changeMsg)
    })
    return {
      msg,
      changeMsg,
    }
  },
}
</script>
å¤åˆ¶ä»£ç 
```

å­ç»„ä»¶2

```js
<template>
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶2
  </div>
  <button @click='changeMsg'>ç‚¹å‡»ä¿®æ”¹msg</button>
</template>

<script>
import { ref } from 'vue'
import emitter from '../mitt'

export default {
  name: '',

  setup() {
    const changeMsg = () => {
      emitter.emit('change-msg')
    }
    return {
      changeMsg,
    }
  },
}
</script>
å¤åˆ¶ä»£ç 
```

æ¼”ç¤º

![1.gif](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2639e54b0f54404fa20bd78566128068~tplv-k3u1fbpfcp-watermark.awebp)

## è‡ªå®šä¹‰æŒ‡ä»¤

å…ˆçœ‹çœ‹`Vue2`è‡ªå®šä¹‰æŒ‡ä»¤çš„é’©å­

- **bind**ï¼šå½“æŒ‡ä»¤ç»‘å®šåœ¨å¯¹åº”å…ƒç´ æ—¶è§¦å‘ã€‚åªä¼šè§¦å‘ä¸€æ¬¡ã€‚
- **inserted**ï¼šå½“å¯¹åº”å…ƒç´ è¢«æ’å…¥åˆ° `DOM` çš„çˆ¶å…ƒç´ æ—¶è§¦å‘ã€‚
- **update**ï¼šå½“å…ƒç´ æ›´æ–°æ—¶ï¼Œè¿™ä¸ªé’©å­ä¼šè¢«è§¦å‘ï¼ˆæ­¤æ—¶å…ƒç´ çš„åä»£å…ƒç´ è¿˜æ²¡æœ‰è§¦å‘æ›´æ–°ï¼‰ã€‚
- **componentUpdated**ï¼šå½“æ•´ä¸ªç»„ä»¶ï¼ˆåŒ…æ‹¬å­ç»„ä»¶ï¼‰å®Œæˆæ›´æ–°åï¼Œè¿™ä¸ªé’©å­è§¦å‘ã€‚
- **unbind**ï¼šå½“æŒ‡ä»¤è¢«ä»å…ƒç´ ä¸Šç§»é™¤æ—¶ï¼Œè¿™ä¸ªé’©å­ä¼šè¢«è§¦å‘ã€‚ä¹Ÿåªè§¦å‘ä¸€æ¬¡ã€‚

åœ¨` Vue3` ä¸­ï¼Œå®˜æ–¹ä¸ºäº†æ›´æœ‰åŠ©äºä»£ç çš„å¯è¯»æ€§å’Œé£æ ¼ç»Ÿä¸€ï¼ŒæŠŠè‡ªå®šä¹‰æŒ‡ä»¤çš„é’©å­åç§°æ”¹çš„æ›´åƒæ˜¯ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œå°½ç®¡ä»–ä»¬æ˜¯ä¸¤å›äº‹

- **bind** => **beforeMount**
- **inserted** => **mounted**
- **beforeUpdate**: **æ–°çš„é’©å­ï¼Œä¼šåœ¨å…ƒç´ è‡ªèº«æ›´æ–°å‰è§¦å‘**
- **update** => **ç§»é™¤**ï¼
- **componentUpdated** => **updated**
- **beforeUnmount**: **æ–°çš„é’©å­ï¼Œå½“å…ƒç´ è‡ªèº«è¢«å¸è½½å‰è§¦å‘**
- **unbind** => **unmounted**

## è¿‡æ¸¡åŠ¨ç”»

è¿™ä¸ªæ²¡æœ‰ä»€ä¹ˆå¤§çš„æ”¹åŠ¨ï¼Œåªæ˜¯ä¿®æ”¹äº†ä¸¤ä¸ª`class`åå­—ï¼Œæ­£æ˜¯å› ä¸ºæ²¡æœ‰ä»€ä¹ˆå¤§çš„æ”¹åŠ¨ï¼Œå¯¼è‡´æˆ‘æ›¾ç»åœ¨è¿™é‡Œæ ½äº†å¤§è·Ÿå¤´ï¼Œå†™å®Œäº†æ€ä¹ˆéƒ½ä¸å¯¹ï¼Œåæ¥æŸ¥å®˜ç½‘æ‰çŸ¥é“ã€‚

ä»¥ä¸‹æ˜¯ç›´æ¥å¼•ç”¨ **å®˜ç½‘çš„åŸæ–‡**

> - **v-enter-from**ï¼šå®šä¹‰è¿›å…¥è¿‡æ¸¡çš„å¼€å§‹çŠ¶æ€ã€‚åœ¨å…ƒç´ è¢«æ’å…¥ä¹‹å‰ç”Ÿæ•ˆï¼Œåœ¨å…ƒç´ è¢«æ’å…¥ä¹‹åçš„ä¸‹ä¸€å¸§ç§»é™¤ã€‚
> - **v-enter-active**ï¼šå®šä¹‰è¿›å…¥è¿‡æ¸¡ç”Ÿæ•ˆæ—¶çš„çŠ¶æ€ã€‚åœ¨æ•´ä¸ªè¿›å…¥è¿‡æ¸¡çš„é˜¶æ®µä¸­åº”ç”¨ï¼Œåœ¨å…ƒç´ è¢«æ’å…¥ä¹‹å‰ç”Ÿæ•ˆï¼Œåœ¨è¿‡æ¸¡/åŠ¨ç”»å®Œæˆä¹‹åç§»é™¤ã€‚è¿™ä¸ªç±»å¯ä»¥è¢«ç”¨æ¥å®šä¹‰è¿›å…¥è¿‡æ¸¡çš„è¿‡ç¨‹æ—¶é—´ï¼Œå»¶è¿Ÿå’Œæ›²çº¿å‡½æ•°ã€‚
> - **v-enter-to**ï¼šå®šä¹‰è¿›å…¥è¿‡æ¸¡çš„ç»“æŸçŠ¶æ€ã€‚åœ¨å…ƒç´ è¢«æ’å…¥ä¹‹åä¸‹ä¸€å¸§ç”Ÿæ•ˆ (ä¸æ­¤åŒæ—¶ v-enter-from è¢«ç§»é™¤)ï¼Œåœ¨è¿‡æ¸¡/åŠ¨ç”»å®Œæˆä¹‹åç§»é™¤ã€‚
> - **v-leave-from**ï¼šå®šä¹‰ç¦»å¼€è¿‡æ¸¡çš„å¼€å§‹çŠ¶æ€ã€‚åœ¨ç¦»å¼€è¿‡æ¸¡è¢«è§¦å‘æ—¶ç«‹åˆ»ç”Ÿæ•ˆï¼Œä¸‹ä¸€å¸§è¢«ç§»é™¤ã€‚
> - **v-leave-active**ï¼šå®šä¹‰ç¦»å¼€è¿‡æ¸¡ç”Ÿæ•ˆæ—¶çš„çŠ¶æ€ã€‚åœ¨æ•´ä¸ªç¦»å¼€è¿‡æ¸¡çš„é˜¶æ®µä¸­åº”ç”¨ï¼Œåœ¨ç¦»å¼€è¿‡æ¸¡è¢«è§¦å‘æ—¶ç«‹åˆ»ç”Ÿæ•ˆï¼Œåœ¨è¿‡æ¸¡/åŠ¨ç”»å®Œæˆä¹‹åç§»é™¤ã€‚è¿™ä¸ªç±»å¯ä»¥è¢«ç”¨æ¥å®šä¹‰ç¦»å¼€è¿‡æ¸¡çš„è¿‡ç¨‹æ—¶é—´ï¼Œå»¶è¿Ÿå’Œæ›²çº¿å‡½æ•°ã€‚
> - **v-leave-to**ï¼šç¦»å¼€è¿‡æ¸¡çš„ç»“æŸçŠ¶æ€ã€‚åœ¨ç¦»å¼€è¿‡æ¸¡è¢«è§¦å‘ä¹‹åä¸‹ä¸€å¸§ç”Ÿæ•ˆ (ä¸æ­¤åŒæ—¶ v-leave-from è¢«åˆ é™¤)ï¼Œåœ¨è¿‡æ¸¡/åŠ¨ç”»å®Œæˆä¹‹åç§»é™¤ã€‚

ç‰¹åˆ«æ³¨æ„çš„æ˜¯`v-enter`æ”¹æˆäº†`v-enter-form`ï¼Œ`v-leave`æ”¹æˆäº†`v-leave-from`ã€‚

## å…¶ä»–å°çŸ¥è¯†

> ```
> Vue3`ç§»é™¤äº†`filter
> ```

> è·å–ç»„ä»¶å®ä¾‹æ–¹æ³•`getCurrentInstance()`

