---
title: this的三种特殊指向
date: 2021-07-01
tags:
 - JavaScript
categories:
 -  面试相关
---

## 前言

有三种情况下的 `this` 指向，是不需要动脑筋的，因为一看就是指向 `window` ，那么，分别是以下三种情况

- 立即执行函数（ `IIFE` ）
- `setTimeout` 中传入的函数
- `setInterval` 中传入的函数

在这之前，我们先来看一个例子，为下面的例子进行铺垫

```javascript
var name = 'windowName'

var dog = {
  name: 'wangcai',
  // 声明位置
  hello: function() {
    console.log(this.name)
  },
}

dog.hello() // wangcai
复制代码
```

接下来，我们来逐个讲解 `this` 的三种特殊指向。

## 立即执行函数（ `IIFE` ）

所谓立即执行函数，就是**定义后立刻调用的匿名函数**，为了证实这一个观点，我们来改写下上面的代码

```javascript
var name = 'windowName'

var dog = {
  name: 'wangcai',
  // 声明位置
  hello: function() {
    (function () {
      console.log(this.name)
    }())
  },
}

dog.hello() // windowName
复制代码
```

可以看到，我们将 `hello` 方法重写了，在内部采用了立即执行函数的方式来 `console.log(this.name)` ，结果输出的是 `this.name` 。


当调用方法没有明确对象时，`this` 就指向全局对象。在浏览器中，指向 `window`；在 `Node` 中，指向 `Global`。（严格模式下，指向 `undefined`）

立即执行函数，就是所谓的定义后立刻调用的匿名函数，它并没有明确指定调用对象，所以，就指向了 `window` ，也就是最后输出的 `windowName` 。以后看到 **立即执行函数**，我们就要首先想到**指向全局对象**。

## `setTimeout` 以及 `setInterval` 中传入的函数

`setTimeout` 也同样有着指向 `window` 的黑魔法，我们来具体看一下这个例子：

```javascript
var name = 'windowName'

var dog = {
  name: 'wangcai',
  // 声明位置
  hello: function() {
    setTimeout(function () {
      console.log(this.name);
    },100)
  },
}

dog.hello() // windowName
复制代码
```

可以看到，同样地，输出的也是 windowName 。

**`this` 永远指向最后调用它的那个对象**。

我们都知道， `setTimeout` 是属于 `window` 的方法，从 [MDN](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindowOrWorkerGlobalScope%2FsetTimeout) 中的描述大家就可以看出来了。

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d5de21e6b754637b2e76caf207b8cb5~tplv-k3u1fbpfcp-watermark.awebp)

所以，在 `setTimeout` 中传入的函数，最后的调用对象始终是 `window`

也就是说，上面的代码可以这么来理解

```javascript
var name = 'windowName'

var dog = {
  name: 'wangcai',
  // 声明位置
  hello: function() {
    window.setTimeout(function () {
      console.log(this.name);
    },100)
  },
}

dog.hello() // windowName
复制代码
```

首先执行 `dog.hello()` 那么此刻，调用对象是 `dog` ，接着进入 `dog.hello()` 方法，执行了 `window.setTimeout` ，也就是说最后，执行 `console.log(this.name)` 的时候， `this` 指向已经是 `window` 了。也就是最后输出 windowName 。

当然， `setInterval` 也是同理。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4bf7b6bc4b8e423c83dbd651ec45bd26~tplv-k3u1fbpfcp-watermark.awebp)

最后，再来总结一下，那就是：

**`this` 永远指向最后调用它的那个对象**

当调用方法没有明确对象时，`this` 就指向全局对象。在浏览器中，指向 `window`；在 `Node` 中，指向 `Global`。（严格模式下，指向 `undefined`）